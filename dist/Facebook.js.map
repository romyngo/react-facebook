{"version":3,"sources":["../src/Facebook.js"],"names":["Method","GET","POST","DELETE","Facebook","constructor","options","domain","version","cookie","status","xfbml","language","frictionlessRequests","debug","appId","Error","wait","init","getAppId","loadingPromise","Promise","resolve","restOptions","window","fbAsyncInit","FB","fjs","document","getElementsByTagName","getElementById","js","createElement","id","async","src","parentNode","insertBefore","process","method","before","after","fb","reject","response","error","code","type","message","ui","api","path","params","login","opts","logout","getLoginStatus","getAuthResponse","getTokenDetail","LoginStatus","CONNECTED","authResponse","getProfile","getTokenDetailWithProfile","tokenDetail","profile","getToken","accessToken","getUserId","userID","sendInvite","to","postAction","ogNamespace","ogAction","ogObject","ogObjectUrl","noFeedStory","url","encodeURIComponent","getPermissions","data","hasPermissions","permissions","usersPermissions","findedPermissions","filter","p","currentPermission","find","row","permission","length","subscribe","eventName","callback","Event","unsubscribe","parse","XFBML","getRequests","removeRequest","requestID","setAutoGrow","Canvas","paySimple","product","quantity","action","pay"],"mappings":"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","sourcesContent":["// @flow\nimport LoginStatus from \"./constants/LoginStatus\";\n\nexport const Method = {\n  GET: \"get\",\n  POST: \"post\",\n  DELETE: \"delete\"\n};\n\nexport default class Facebook {\n  constructor(options = {}) {\n    this.options = {\n      domain: \"connect.facebook.net\",\n      version: \"v3.1\",\n      cookie: false,\n      status: false,\n      xfbml: false,\n      language: \"en_US\",\n      frictionlessRequests: false,\n      debug: false,\n      ...options\n    };\n\n    if (!this.options.appId) {\n      throw new Error(\"You need to set appId\");\n    }\n\n    if (!this.options.wait) {\n      this.init();\n    }\n  }\n\n  getAppId(): string {\n    return this.options.appId;\n  }\n\n  async init() {\n    if (this.loadingPromise) {\n      return this.loadingPromise;\n    }\n\n    this.loadingPromise = new Promise(resolve => {\n      const { domain, language, debug, ...restOptions } = this.options;\n\n      window.fbAsyncInit = () => {\n        window.FB.init({\n          appId: restOptions.appId,\n          version: restOptions.version,\n          cookie: restOptions.cookie,\n          status: restOptions.status,\n          xfbml: restOptions.xfbml,\n          frictionlessRequests: this.frictionlessRequests\n        });\n\n        resolve(window.FB);\n      };\n\n      const fjs = window.document.getElementsByTagName(\"script\")[0];\n      if (!fjs) {\n        return;\n      }\n\n      if (window.document.getElementById(\"facebook-jssdk\")) {\n        return;\n      }\n\n      const js = window.document.createElement(\"script\");\n      js.id = \"facebook-jssdk\";\n      js.async = true;\n      js.src = `https://${domain}/${language}/sdk/xfbml.customerchat.js`;\n\n      fjs.parentNode.insertBefore(js, fjs);\n    });\n\n    return this.loadingPromise;\n  }\n\n  async process(method, before = [], after = []) {\n    const fb = await this.init();\n\n    return new Promise((resolve, reject) => {\n      fb[method](\n        ...before,\n        response => {\n          if (!response) {\n            reject(new Error(\"Response is undefined\"));\n          } else if (response.error) {\n            const { code, type, message } = response.error;\n\n            const error = new Error(message);\n            error.code = code;\n            error.type = type;\n\n            reject(error);\n          } else {\n            resolve(response);\n          }\n        },\n        ...after\n      );\n    });\n  }\n\n  async ui(options) {\n    return this.process(\"ui\", [options]);\n  }\n\n  async api(path, method = Method.GET, params = {}) {\n    return this.process(\"api\", [path, method, params]);\n  }\n\n  async login(opts = null) {\n    return this.process(\"login\", [], [opts]);\n  }\n\n  async logout() {\n    return this.process(\"logout\");\n  }\n\n  async getLoginStatus() {\n    return this.process(\"getLoginStatus\");\n  }\n\n  async getAuthResponse() {\n    return this.process(\"getAuthResponse\");\n  }\n\n  async getTokenDetail() {\n    const response = await this.getLoginStatus();\n    if (response.status === LoginStatus.CONNECTED && response.authResponse) {\n      return response.authResponse;\n    }\n\n    throw new Error(\"Token is undefined\");\n  }\n\n  async getProfile(params) {\n    return this.api(\"/me\", Method.GET, params);\n  }\n\n  async getTokenDetailWithProfile(params) {\n    const tokenDetail = await this.getTokenDetail();\n    const profile = await this.getProfile(params);\n\n    return {\n      profile,\n      tokenDetail\n    };\n  }\n\n  async getToken() {\n    const authResponse = await this.getTokenDetail();\n    return authResponse.accessToken;\n  }\n\n  async getUserId() {\n    const authResponse = await this.getTokenDetail();\n    return authResponse.userID;\n  }\n\n  async sendInvite(to, options) {\n    return this.ui({\n      to,\n      method: \"apprequests\",\n      ...options\n    });\n  }\n\n  async postAction(ogNamespace, ogAction, ogObject, ogObjectUrl, noFeedStory) {\n    let url = `/me/${ogNamespace}:${ogAction}?${ogObject}=${encodeURIComponent(\n      ogObjectUrl\n    )}`;\n\n    if (noFeedStory === true) {\n      url += \"&no_feed_story=true\";\n    }\n\n    return this.api(url, Method.POST);\n  }\n\n  async getPermissions() {\n    const response = await this.api(\"/me/permissions\");\n    return response.data;\n  }\n\n  async hasPermissions(permissions) {\n    const usersPermissions = await this.getPermissions();\n\n    const findedPermissions = permissions.filter(p => {\n      const currentPermission = usersPermissions.find(row => {\n        const { permission, status } = row;\n        return status === \"granted\" && permission === p;\n      });\n\n      return !!currentPermission;\n    });\n\n    return findedPermissions.length === permissions.length;\n  }\n\n  async subscribe(eventName, callback) {\n    const fb = await this.init();\n    fb.Event.subscribe(eventName, callback);\n  }\n\n  async unsubscribe(eventName, callback) {\n    const fb = await this.init();\n    fb.Event.unsubscribe(eventName, callback);\n  }\n\n  async parse(parentNode) {\n    const fb = await this.init();\n\n    if (typeof parentNode === \"undefined\") {\n      fb.XFBML.parse();\n    } else {\n      fb.XFBML.parse(parentNode);\n    }\n  }\n\n  async getRequests() {\n    return this.api(\"/me/apprequests\");\n  }\n\n  async removeRequest(requestID) {\n    return this.api(requestID, Method.DELETE);\n  }\n\n  async setAutoGrow() {\n    const fb = await this.init();\n    fb.Canvas.setAutoGrow();\n  }\n\n  async paySimple(product, quantity = 1) {\n    return this.ui({\n      method: \"pay\",\n      action: \"purchaseitem\",\n      product,\n      quantity\n    });\n  }\n\n  async pay(product, options) {\n    return this.ui({\n      method: \"pay\",\n      action: \"purchaseitem\",\n      product,\n      ...options\n    });\n  }\n}\n\n/*\n  sendToFriends: function(options, callback) {\n    if(!options) {\n      options = {};\n    }\n\n    options.method = 'send';\n\n    this.afterLoad(function(err, fbApi) {\n      if(err) {\n        return callback(err);\n      }\n\n      FB.ui(options, function(response) {\n        fbApi._callCallbackByResponse(callback, response);\n      });\n    });\n  },\n\n  sendMessage: function(message, name, caption, description, url, imgUrl, callback) {\n    this.afterLoad(function(err, fbApi) {\n      if(err) {\n        return callback(err);\n      }\n\n      FB.ui({\n        method: 'stream.publish',\n        message: message,\n        attachment: {\n          name: name,\n          caption: caption,\n          description: description,\n          href: url,\n          media:[{\n            type: 'image',\n            src:  imgUrl,\n            href: url\n          }]\n        },\n        action_links: [{\n          text: 'Code',\n          href: url\n        }],\n        user_prompt_message: message\n      },\n      function(response) {\n        fbApi._callCallbackByResponse(callback, response);\n      });\n    });\n  },\n\n  sendInviteForm: function(options, callback) {\n    if(typeof options === 'function') {\n      callback = options;\n      options = {};\n    }\n\n    this.afterLoad(function(err, fbApi) {\n      if(err) {\n        return callback(err);\n      }\n\n      options.method = options.method || 'apprequests';\n\n\n      FB.ui(options, function(response) {\n        fbApi._callCallbackByResponse(callback, response);\n      });\n    });\n  },\n\n  checkPageLike: function(pageID, callback) {\n    this.afterLoad(function(err, fbApi) {\n      if(err) {\n        return callback(err);\n      }\n\n      fbApi.getUserID(function(err, userID) {\n        if(err) {\n          return callback(err);\n        }\n\n        var fqlQuery = `SELECT uid FROM page_fan WHERE page_id = ${pageID} and uid = ${userID}`;\n        var query = FB.Data.query(fqlQuery);\n\n        query.wait(function(rows) {\n          if (rows.length === 1 && rows[0].uid === userID) {\n            callback(null, true, query);\n          }\n          else {\n            callback(null, false, query);\n          }\n        });\n      });\n    });\n  },\n\n  sendMessageToFriend: function (friendID, link, callback) {\n    this.afterLoad(function(err, fbApi) {\n      if(err) {\n        return callback(err);\n      }\n\n      FB.ui({\n        to: friendID,\n        method: 'send',\n        link: link\n      }, function(response) {\n        fbApi._callCallbackByResponse(callback, response);\n      });\n    });\n  },\n\n  _prepareUsers: function(data) {\n    var users=[];\n\n    for(var index in data) {\n      var userData=data[index];\n\n      var user = {\n        provider_uid: 'facebook'+'_'+userData.uid,\n        provider: 'facebook',\n        id: userData.uid,\n        name: userData.name,\n        first_name: userData.first_name,\n        last_name: userData.last_name,\n        status: (userData.status!==null) ? userData.status : null,\n        image: '//graph.facebook.com/'+userData.uid+'/picture?'\n      };\n\n      users.push(user);\n    }\n\n    return users;\n  },\n\n  getUserList: function(callback) {\n    this.afterLoad(function(err, fbApi) {\n      if(err) {\n        return callback(err);\n      }\n\n      FB.api('fql', {\n        q: `\n          SELECT uid, name, first_name, last_name, online_presence, status\n          FROM user\n          WHERE uid IN\n            ( SELECT uid2 FROM friend WHERE uid1 = me()) ORDER BY name\n        `,\n      }, function (response)\n      {\n        var users = fbApi._prepareUsers(response.data);\n        callback(null, users, response);\n      });\n    });\n  },\n\n  postFeed: function(options, callback) {\n    this.afterLoad(function(err, fbApi) {\n      if(err) {\n        return callback(err);\n      }\n\n      options.method='feed';\n\n      FB.ui(options, function(response) {\n        fbApi._callCallbackByResponse(callback, response);\n      });\n    });\n  },\n\n  //need publish_stream\n  createAlbum: function(name, description, callback) {\n    this.afterLoad(function(err, fbApi) {\n      if(err) {\n        return callback(err);\n      }\n\n      FB.api('/me/albums', 'post', {\n        name: name,\n        description: description\n      },function(response) {\n        fbApi._callCallbackByResponse(callback, response);\n      });\n    });\n  },\n\n  //need publish_stream\n  addImageToAlbum: function(albumID, imageURL, message, callback) {\n    this.afterLoad(function(err, fbApi) {\n      if(err) {\n        return callback(err);\n      }\n\n      FB.api('/'+albumID+'/photos', 'post', {\n        message: message,\n        url: imageURL\n      }, function(response) {\n        fbApi._callCallbackByResponse(callback, response);\n      });\n    });\n  },\n\n  //'user_photos'\n  getAlbums: function(callback) {\n    this.afterLoad(function(err, fbApi) {\n      if(err) {\n        return callback(err);\n      }\n\n      FB.api('/me/albums', function(response) {\n        fbApi._callCallbackByResponse(callback, response);\n      });\n    });\n  },\n\n  //'user_photos'\n  getAlbumPhotos: function(albumID, callback) {\n    this.afterLoad(function(err, fbApi) {\n      if(err) {\n        return callback(err);\n      }\n\n      FB.api('/'+albumID+'/photos', function(response) {\n        fbApi._callCallbackByResponse(callback, response);\n      });\n    });\n  },\n\n  //'user_photos'\n  getAlbumCoverPicture: function(albumID, callback) {\n    this.afterLoad(function(err, fbApi) {\n      if(err) {\n        return callback(err);\n      }\n\n      FB.api('/'+albumID+'/picture', function(response) {\n        fbApi._callCallbackByResponse(callback, response);\n      });\n    });\n  },\n\n  //'publish_stream'\n  postPhoto: function(photoUrl, message, callback) {\n    this.afterLoad(function(err, fbApi) {\n      if(err) {\n        return callback(err);\n      }\n\n      FB.api('/me/photos', 'post', {\n        message: message,\n        url: photoUrl\n      },function(response) {\n        fbApi._callCallbackByResponse(callback, response);\n      });\n    });\n  },\n\n  getPageInfo: function(callback) {\n    this.afterLoad(function(err, fbApi) {\n      if(err) {\n        return callback(err);\n      }\n\n      FB.Canvas.getPageInfo(function(response) {\n        fbApi._callCallbackByResponse(callback, response);\n      });\n    });\n  }\n*/\n"],"file":"Facebook.js"}